/**
 * tinymce plugin
 * Created by xwf on 18/11/12.
 */
tinymce.PluginManager.add('iw_2em', function (editor,url) {

	/**
     * 增加text-index
     *
     * @param editor 编辑器
     * @param plus 1:累加、0：切换、-1：累减
     * @author hewei
     */
    function addTextIndent(editor, plus) {
        var node = editor.selection.getNode();
        var nodeName = node.nodeName;
        if (nodeName == 'P' || nodeName == 'DIV' ||
            nodeName == 'H1' || nodeName == 'H2' || nodeName == 'H3' || nodeName == 'H4' || nodeName == 'H5' || nodeName == 'H6'
        ){
            var indent = parseInt(editor.dom.getStyle(node, 'text-indent'));
            // 修正2的倍数
            indent = isNaN(indent) ? 0 : parseInt(indent/2) * 2;
            // 缩进处理
            if (plus == 1){
                // 累加
                indent += 2;
            } else if (plus == -1){
                // 累减
                indent -= 2;
            } else {
                indent = indent - 2 < 0 ? 2 : indent - 2;
            }
            // 判断是否已经添加样式
            var style = indent <= 0 ? '' : indent + 'em';
            editor.dom.setStyle(node, 'text-indent', style);
        };
    }

    /**
     * tab处理
     *
     * @param e
     * @param editor 编辑器
     * @author hewei
     */
    function tabHandler(e, editor) {
        if (e.keyCode === 9 && !e.ctrlKey && !e.altKey && !e.metaKey) {
            addTextIndent(editor, e.shiftKey ? -1 : 1);
            // 阻止事件传递
            e.preventDefault();
        }
    }


    editor.addCommand("mce_iw_2em", function() {addTextIndent(editor, 0);});

    editor.addButton('iw_2em', {
    	image: url+'/iw-2em.png',
        tooltip: '首行缩进',
        onclick : function() {
            addTextIndent(editor, 0);
        } 
    });

    editor.addMenuItem('iw_2em', {
    	image: '././iw-2em.png',
        text: '首行缩进',
        context: 'tools',
        onclick : function() {
            addTextIndent(editor, 0);
        }
    });
});